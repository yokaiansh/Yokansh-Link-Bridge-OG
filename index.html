<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Gateway</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { 
            --glass: rgba(15, 23, 42, 0.85); 
            --border: rgba(255, 255, 255, 0.08); 
            --accent: #38bdf8; 
            --bg-dark: #020617;
        }
        body { 
            margin: 0; font-family: 'Inter', sans-serif; height: 100vh;
            background: radial-gradient(circle at center, #1e293b, var(--bg-dark));
            display: flex; align-items: center; justify-content: center; color: white; overflow: hidden;
        }
        /* Curved, Black themed, Glassy semi-transparent BG */
        .glass-card {
            background: var(--glass); 
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border); 
            border-radius: 40px; /* Highly curved */
            padding: 40px; width: 360px; text-align: center;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.7);
        }
        .step { display: none; flex-direction: column; align-items: center; }
        .step.active { display: flex; animation: slideUp 0.4s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Timer/Clock Style */
        .clock-icon { font-size: 3rem; margin-bottom: 15px; display: block; }
        .timer-text { font-size: 1.1rem; color: #94a3b8; margin-bottom: 20px; }

        /* Buttons */
        .btn {
            background: var(--accent); color: #000; border: none;
            padding: 12px 35px; border-radius: 12px; font-weight: 600;
            cursor: pointer; transition: 0.3s; font-size: 1rem;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(56, 189, 248, 0.4); }

        /* Loading Bar */
        .progress-container { width: 100%; height: 8px; background: #334155; border-radius: 10px; margin: 20px 0; overflow: hidden; }
        .progress-fill { width: 0%; height: 100%; background: var(--accent); transition: width 5s linear; }
    </style>
</head>
<body>

<div class="glass-card">
    <div id="step1" class="step active">
        <span class="clock-icon">‚è≥</span>
        <p class="timer-text" id="t1">Checking security... 5s</p>
        <button class="btn" id="btn1" style="display:none;" onclick="nextStep(1, 2)">Continue</button>
    </div>

    <div id="step2" class="step">
        <span class="clock-icon">üõ°Ô∏è</span>
        <p class="timer-text" id="t2">Verifying handshake... 5s</p>
        <button class="btn" id="btn2" style="display:none;" onclick="startLoading()">Proceed</button>
    </div>

    <div id="step3" class="step">
        <p class="timer-text">Finalizing Encryption...</p>
        <div class="progress-container">
            <div class="progress-fill" id="fill"></div>
        </div>
        <button class="btn" id="btn3" style="display:none;" onclick="finish()">Start</button>
    </div>
</div>

<script>
    const params = new URLSearchParams(window.location.search);
    const target = params.get('target');
    const ts = params.get('ts');
    const arolinkApiKey = params.get('ak');

    // Security Cleanup
    if (window.history.replaceState) {
        window.history.replaceState({}, document.title, window.location.pathname);
    }

    // Step 1 Timer Logic
    function runTimer(id, btnId, callback) {
        let sec = 5;
        const text = document.getElementById(id);
        const timer = setInterval(() => {
            sec--;
            text.innerText = `Please wait... ${sec}s`;
            if (sec <= 0) {
                clearInterval(timer);
                text.style.display = 'none';
                document.getElementById(btnId).style.display = 'inline-block';
            }
        }, 1000);
    }

    // Initialize first timer
    runTimer('t1', 'btn1');

    function nextStep(current, next) {
        document.getElementById(`step${current}`).classList.remove('active');
        document.getElementById(`step${next}`).classList.add('active');
        if (next === 2) runTimer('t2', 'btn2');
    }

    function startLoading() {
        nextStep(2, 3);
        const fill = document.getElementById('fill');
        setTimeout(() => { fill.style.width = '100%'; }, 100);
        
        // Show Start button after 5s
        setTimeout(() => {
            document.getElementById('btn3').style.display = 'inline-block';
        }, 5100);
    }

    function finish() {
        const finalDest = atob(target);
        if (arolinkApiKey) {
            fetch(`https://arolinks.com/api?api=${arolinkApiKey}&url=${finalDest}`)
                .then(r => r.json())
                .then(data => {
                    window.location.href = (data.status === "success") ? data.shortenedUrl : finalDest;
                }).catch(() => window.location.href = finalDest);
        } else {
            window.location.href = finalDest;
        }
    }
</script>
</body>
</html>
