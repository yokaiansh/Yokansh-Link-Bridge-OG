<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Gateway</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { 
            --glass: rgba(15, 23, 42, 0.85); 
            --border: rgba(255, 255, 255, 0.08); 
            --accent: #38bdf8; 
            --bg-dark: #020617;
        }
        body { 
            margin: 0; font-family: 'Inter', sans-serif; height: 100vh;
            background: radial-gradient(circle at center, #1e293b, var(--bg-dark));
            display: flex; align-items: center; justify-content: center; color: white; overflow: hidden;
        }
        .glass-card {
            background: var(--glass); 
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border); 
            border-radius: 40px;
            padding: 40px; width: 360px; text-align: center;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.7);
        }
        .step { display: none; flex-direction: column; align-items: center; }
        .step.active { display: flex; animation: slideUp 0.4s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .icon { font-size: 3.5rem; margin-bottom: 15px; display: block; }
        .timer-text { font-size: 1.1rem; color: #94a3b8; margin-bottom: 20px; }

        .btn {
            background: var(--accent); color: #000; border: none;
            padding: 12px 35px; border-radius: 12px; font-weight: 600;
            cursor: pointer; transition: 0.3s; font-size: 1rem;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(56, 189, 248, 0.4); }

        /* Captcha Styles */
        .captcha-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 15px; width: 100%; }
        .color-box { height: 70px; border-radius: 15px; cursor: pointer; transition: 0.2s; border: 2px solid rgba(255,255,255,0.1); }
        .color-box:hover { transform: scale(1.05); border-color: white; }

        .progress-container { width: 100%; height: 8px; background: #334155; border-radius: 10px; margin: 20px 0; overflow: hidden; }
        .progress-fill { width: 0%; height: 100%; background: var(--accent); transition: width 5s linear; }
    </style>
</head>
<body>

<div id="main-content" class="glass-card">
    <div id="step1" class="step active">
        <span class="icon">‚è≥</span>
        <p class="timer-text" id="t1">Checking security... 5s</p>
        <button class="btn" id="btn1" style="display:none;" onclick="showCaptcha()">Continue</button>
    </div>

    <div id="step-captcha" class="step">
        <p class="timer-text">Select the <b id="target-color-name" style="color:var(--accent)">...</b> box</p>
        <div class="captcha-grid" id="captcha-grid"></div>
    </div>

    <div id="step2" class="step">
        <span class="icon">üõ°Ô∏è</span>
        <p class="timer-text" id="t2">Checking security... 5s</p>
        <button class="btn" id="btn2" style="display:none;" onclick="startLoading()">Proceed</button>
    </div>

    <div id="step3" class="step">
        <p class="timer-text">Finalizing Encryption...</p>
        <div class="progress-container">
            <div class="progress-fill" id="fill"></div>
        </div>
        <button class="btn" id="btn3" style="display:none;" onclick="finish()">Start</button>
    </div>
</div>

<script>
    const params = new URLSearchParams(window.location.search);
    const target = params.get('target');
    const ts = params.get('ts');
    const arolinkApiKey = params.get('ak');
    const ua = navigator.userAgent || navigator.vendor || window.opera;

    // --- 10 DAY EXPIRATION ---
    const now = Math.floor(Date.now() / 1000);
    if (!target || !ts || (now - parseInt(ts)) > 864000) {
        document.getElementById('main-content').innerHTML = `
            <span class="icon">üö´</span>
            <h2 style="color:#f87171">Link Expired</h2>
            <p style="color:#94a3b8">This link is no longer valid. Please get a fresh one from the bot.</p>
        `;
    } else {
        // Android Telegram Escape
        if (/Telegram/i.test(ua) && /Android/i.test(ua)) {
            window.location.href = "intent://" + window.location.href.replace(/^https?:\/\//, "") + "#Intent;scheme=https;package=com.android.chrome;end";
        }
        if (window.history.replaceState) window.history.replaceState({}, "", window.location.pathname);

        function runTimer(id, btnId) {
            let sec = 5;
            const text = document.getElementById(id);
            const timer = setInterval(() => {
                sec--;
                text.innerText = `Checking security... ${sec}s`;
                if (sec <= 0) {
                    clearInterval(timer);
                    text.style.display = 'none';
                    document.getElementById(btnId).style.display = 'inline-block';
                }
            }, 1000);
        }

        // Initialize first timer
        runTimer('t1', 'btn1');

        function showCaptcha() {
            document.getElementById('step1').classList.remove('active');
            document.getElementById('step-captcha').classList.add('active');
            
            const colors = [
                { name: 'Red', hex: '#ff4d4d' },
                { name: 'Blue', hex: '#3399ff' },
                { name: 'Green', hex: '#2eb82e' },
                { name: 'Yellow', hex: '#ffdb4d' }
            ];
            
            const targetColor = colors[Math.floor(Math.random() * colors.length)];
            document.getElementById('target-color-name').innerText = targetColor.name;
            
            const grid = document.getElementById('captcha-grid');
            grid.innerHTML = '';
            
            // Shuffle and create boxes
            colors.sort(() => Math.random() - 0.5).forEach(color => {
                const box = document.createElement('div');
                box.className = 'color-box';
                box.style.backgroundColor = color.hex;
                box.onclick = () => {
                    if (color.name === targetColor.name) {
                        document.getElementById('step-captcha').classList.remove('active');
                        document.getElementById('step2').classList.add('active');
                        runTimer('t2', 'btn2');
                    } else {
                        alert("Verification failed. Please try again.");
                        showCaptcha();
                    }
                };
                grid.appendChild(box);
            });
        }

        function startLoading() {
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step3').classList.add('active');
            setTimeout(() => { document.getElementById('fill').style.width = '100%'; }, 100);
            setTimeout(() => { document.getElementById('btn3').style.display = 'inline-block'; }, 5100);
        }

        function finish() {
            const btn = document.getElementById('btn3');
            btn.innerText = "Processing...";
            btn.disabled = true;
            const finalDest = atob(target);
            if (arolinkApiKey) {
                fetch(`https://arolinks.com/api?api=${arolinkApiKey}&url=${finalDest}`)
                    .then(r => r.json())
                    .then(data => { window.location.href = (data.status === "success") ? data.shortenedUrl : finalDest; })
                    .catch(() => window.location.href = finalDest);
            } else {
                window.location.href = finalDest;
            }
        }
    }
</script>
</body>
</html>
